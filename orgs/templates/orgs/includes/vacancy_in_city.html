<div class="vacancy-in-city side-panel-block pt-0">
    <div class="row">
        <div class="col title">
            Вакансии <br>
            в вашем городе
        </div>
        <div class="col">
            <div class="input-group">
                <input type="text" class="form-control city" placeholder="Ваш город" aria-label="Город" aria-describedby="side-panel-city">
                <div class="input-group-append" id="search_btn">
                    <span class="input-group-text" id="fast-search-position"><i class="fa fa-angle-down" aria-hidden="true"></i></span>
                </div>
            </div>
            <ul class="search-result"></ul>
        </div>
    </div>
    <div class="d-flex flex-wrap">
    {% for vacancy in view.vacancies %}
        <a href="{% url 'vacancies:vacancy_details' vacancy.id %}" class="w-50 my-3 vacancy-block">
            <div class="grey">
                {{ vacancy.created_date|date:"j F Y" }} г.
            </div>
            <div class="my-2">
                <div class="vacancy">
                    {{ vacancy.title }}
                </div>
                <div class="grey">
                    {{ vacancy.employer.city.name_with_region }}
                </div>
            </div>
            <div>
                <div class="salary">
                    {% if vacancy.salary_min %}
                    от: {{ vacancy.salary_min }} р.
                    {% endif %}
                </div>
                <div class="grey">
                    {{ vacancy.employer.short_name }}
                </div>
            </div>
        </a>
    {% endfor %}
    </div>
</div>
<script>
    const search_result = document.querySelector('.search-result');
    const search_btn = document.querySelector('#search_btn');
    search_result.style.display = 'none';

    search_btn.addEventListener('click', e => {
        search_result.style.display = search_result.style.display === 'none' ? 'block' : 'none';
    });

    fetch("{% url 'orgs:city_search_list' %}")
        .then(result => result.json())
        .then(data => {
            data.cities.forEach(city => {
                let li = document.createElement('li');
                li.innerHTML = city.name;
                li.setAttribute('data-id' , city.id);
                search_result.appendChild(li);
            });
        });
</script>